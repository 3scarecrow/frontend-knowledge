# 请求-应答

HTTP 协议使用的是请求-应答通信模式，即 "一发一收"，也属于 "半双工"（在一方传输报文过程中，另一方不可传输，需待一方传输完毕方可传输）。

那么接下来看看 HTTP 协议传输的报文结构是怎样的

## HTTP 报文结构

HTTP 协议的请求和响应报文的结构很类似，由三大部分组成:

1. 起始行（start line）
2. 头部字段（header）
3. 消息正文（entity）

起始行和头部字段常合称为 "**请求头**" 或 "**响应头**"，即 **header**。消息正文称为 "**实体**"，即 **body**

### 请求行 + 状态行

请求头结构如下:

![请求头结构](../../images/request-header.png)

由上图可知：

**请求行**由三个部分组成:

1. 请求方法: GET/POST/PUT 等
2. 请求目标: URI（唯一资源表示符），表示请求要操作的资源
3. 版本号: 报文使用的 HTTP 协议版本

例如:

`GET / HTTP/1.1`

该请求的请求方法为 `GET` ，请求目标为 `/`，请求的 HTTP 协议版本号为 `1.1`

:::tip 注意
请求头（header）和请求体（body）之间用换行（CRLF）分隔，换行上面表示请求头，下面表示请求体的内容
:::

响应头结构如下:

![响应头结构](../../images/response-header.png)

其中 **状态行** 也是由三部分组成:

1. 版本号: 报文使用功能的 HTTP 协议版本
2. 状态码: 用三位数字码表示请求的处理结果
3. 原因: 作为数字码的解析文字

例如:

`HTTP/1.1 200 OK`

表示 HTTP 协议版本为 `1.1`，且服务器返回的状态码为 `200`（服务器成功处理了请求）

在响应报文中响应头和响应体之间也是用换行分隔的。

### 请求方法

请求方法指的是要求服务器对 URI 资源执行某个动作

HTTP/1.1 中有8种请求方法:

1. GET: 获取资源
2. HEAD: 获取资源的元信息
3. POST: 提交数据
4. PUT: 修改数据
5. DELETE: 删除资源
6. CONNECT: 建立连接隧道
7. OPTIONS: 列出可对资源实行的方法（常用作 CORS 预检请求）
8. TRACE: 追踪请求-响应的传输路径

#### GET

**GET** 表示从服务器获取资源，最为常用功能的请求方法

#### HEAD

**HEAD** 与 **GET** 方法类似，也是从服务器获取资源，但不同之处在于服务器不会返回请求的实体数据，只返回响应头，也就是资源的"**元信息**"

主要用于不需要实体数据的请求，可以避免传输 body 数据的浪费，例如检查文件是否存在等

#### POST

**POST** 表示向指定的 URI 提交数据

#### PUT

**PUT** 的作用与 POST 类似，也可以向服务器提交数据，但 PUT 表示 "修改" 之意，而 POST 表示 "新增" 之意

#### OPTIONS

**OPTIONS** 要求服务器列出可对资源实行的操作方法，在响应头 Allow 字段里返回，常用于 CORS 的预检请求

对于请求方法还有 **安全与幂等** 的概念

在 HTTP 协议里的 "**安全**" 是指请求方法不会对服务器的资源造成实质的修改，一般来说 GET 和 HEAD 方法是安全的，语义上它们是 "只读" 操作，无论请求多少次，服务器上的资源都是不变的

而 POST/PUT/DELETE 方法会修改服务器的资源，所以是 "不安全" 的

而所谓 "**幂等**" 的意思是指多次执行所产生的影响与一次执行产生的影响相同

GET/POST 方法显然是幂等的，DELETE 多次删除同一个资源，结果都是 "资源不存在"，所以也是幂等的

而 POST 是新增数据，多次新增会创建多个资源，所以不是幂等的，而 PUT 是更新数据，多次更新资源与一次更新资源所产生的效果一样（不会创建多个资源），所以是幂等的

### 状态码

状态码在状态行中表示请求的处理结果，状态码有五类:

- 1xx: 提示信息，表示目前是协议处理的中间状态，还需要后续的操作

- 2xx: 成功，报文已经收到并且被正确处理

- 3xx: 重定向，资源位置发生变动，需要客户端重新发送请求

- 4xx: 客户端错误，请求报文有误，服务器无法处理

- 5xx: 服务器错误，服务器在处理请求时内部发生了错误

常用的状态码:

#### 1xx

**101 Switching Protocols**: 切换协议，表示客户端使用 **Upgrade** 头字段，要求在 HTTP 协议的基础上改成其他的协议继续通信，例如 WebSocket。如果服务器同意变更协议，就会返回状态码 101，之后的数据传输便不会再使用 HTTP了

#### 2xx

- **200 OK**: 最常见的成功状态码，表示服务器成功处理了请求

- **204 No Content**: 同 200 基本相同，但响应头后没有 body 数据

- **206 Partical Content** 是 HTTP 分块下载或断点续传的基础，在客户端发送 "范围请求" 获取资源的部分数据时出现，此时的响应的 body 的数据只是资源的一部分

#### 3xx

- **301 Moved Permanently**: 永久重定向，表示此次请求的资源已经不存在，需要改用新的 URI 再次访问

- **302 Moved Temporarily**: 临时重定向，表示请求的资源还在，只是暂时需要用另一个 URI 来访问

301 和 302 都会在响应头里使用字段 **Location（标记了服务器要求重定向的 URI）** 来指明将要跳转的 URI，浏览器都会重定向到新的 URI。

例如启用新域名，服务器切换到新机器等，都应该返回 301，此时浏览器会做适当的优化，例如历史记录、更新书签等，下次就会直接用新的 URI 访问，省去了再次跳转的成本

而如果是暂时的系统维护，只是暂时跳转到临时 URI，则应该返回 302，浏览器不会做缓存优化，下次访问还是用原 URI

- **304 Not Modified**: 用于 If-Modified-Since、If-None-Match等条件请求，当命中协商缓存时，返回该状态码，表示资源未修改

#### 4xx

**403 Forbidden**: 服务器禁止访问资源

**404 Not Found**: 表示请求的资源在服务器上没有找到，，一般是请求的 URI 不存在

**405 Method Not Allowed**: 不允许使用某些请求方法操作资源，例如不允许 GET 只能 POST

#### 5xx

**500 Internal Server Error**: 服务器内部发生了错误，但具体什么错误无从得知

**501 Not Implemented**: 表示客户端请求的功能，服务器还未支持

**502 Bad Gateway**: 通常是服务器作为网关或者代理时返回的错误码，表示服务器自身工作正常，但访问后端服务器时发生了错误

**503 Service Unavailable**: 表示服务器当前繁忙，暂时无法响应服务
